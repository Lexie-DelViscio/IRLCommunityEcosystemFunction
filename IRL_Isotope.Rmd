---
title: "IRL_Isotope"
author: "Lexie DelViscio"
date: "4/4/2022"
output: html_document
---

```{r setup, echo=FALSE}
library(knitr)
opts_knit$set(tidy=TRUE)
```

## R Markdown
Lets start by loading in libraries we will need 
```{r}
library("xlsx")
library(ggplot2)
library(forcats)
library(tidyr)
library(dplyr)
library(priceTools)
library(vegan)
library(dummies)
```

and the data we will be using. 
```{r}
isotope_data <- read.xlsx("edited_community_isotope_data.xlsx",2)
```

Simple visualization of the data
```{r}
head(isotope_data)
unique(isotope_data$Taxa)
```
The values contained in the columns pedino_13C_enrichment and pico_15N_enrichment represent FILL IN

The values contained in the columns atom_13C_percent and atom_15N_percent represent FILL IN

Barplots of the Means across each column of interest for Taxa
```{r}
#barplots by taxa means
par(mfrow=c(2,2))
color_vector_taxa = rev(rainbow(length(unique(isotope_data$Taxa))))
mean_taxa_pedino = tapply(isotope_data$pedino_13C_enrichment, isotope_data$Taxa, mean)
mean_taxa_pedino_percent = tapply(isotope_data$atom_13C_percent,isotope_data$Taxa, mean)
barplot(mean_taxa_pedino,las=2, col = color_vector_taxa, ylab = 'Pedino Enrichment (13C) Mean', main = "Pedino Enrichment Mean vs. Taxa")
barplot(mean_taxa_pedino_percent, las=2, ylim=c(0.0, 1.2), col = color_vector_taxa, ylab = 'Pedino 13C atom% mean', main = "Pedino Atom% vs. Taxa")

mean_taxa_pico = tapply(isotope_data$pico_15N_enrichment, isotope_data$Taxa, mean)
mean_taxa_pico_percent = tapply(isotope_data$atom_15N_percent,isotope_data$Taxa, mean)
barplot(mean_taxa_pico,las=2, col = color_vector_taxa, ylab = "Pico Enrichment (15N) Mean", main = "Pico Enrichment Mean vs. Taxa")
barplot(mean_taxa_pico_percent, las=2, col = color_vector_taxa,ylab = "Pico Atom% (15N)", main = "Pico Atom% Mean vs. Taxa")
```

Barplots of the Means across variable each column for Site
```{r}
#barplots by site
par(mfrow=c(2,2))
color_vector_site = rev(terrain.colors(length(unique(isotope_data$Taxa))))
mean_site_pedino = tapply(isotope_data$pedino_13C_enrichment, isotope_data$Panel_Site, mean)
mean_site_pedino_percent = tapply(isotope_data$atom_13C_percent,isotope_data$Panel_Site, mean)
barplot(mean_site_pedino,las=2, col = color_vector_site, ylab = "Pedino Enrichment (13C) Mean", main = "Pedino Enrichment vs Site")
barplot(mean_site_pedino_percent, las=2, ylim=c(0.0, 1.2), col = color_vector_site,ylab = "Pedino Atom% (13C)", main = "Pedino Atom% Mean vs. Site")

mean_site_pico = tapply(isotope_data$pico_15N_enrichment, isotope_data$Panel_Site, mean)
mean_site_pico_percent = tapply(isotope_data$atom_15N_percent,isotope_data$Panel_Site, mean)
barplot(mean_site_pico,las=2, col = color_vector_site, ylab = "Pico Enrichment (15N) Mean", main = "Pico Enrichment Mean vs. Site")
barplot(mean_site_pico_percent, las=2, col = color_vector_site,ylab = "Pico Atom% (15N) Mean", main = "Pico Atom% Mean vs. Site")
```
Now we will make some boxplots for Taxa and Enrichment
```{r}
ggplot(data = isotope_data) + 
  geom_boxplot(mapping = aes(x = Taxa, y = pedino_13C_enrichment, color = Taxa)) +  
  labs(x = 'Taxa', y = 'pedino_13C_enrichment', title = 'taxa vs pedino_13C_enrichment') + theme(axis.text.x = element_text(angle = 90))

ggplot(data = isotope_data) + 
  geom_boxplot(mapping = aes(x = Taxa, y = pico_15N_enrichment, color = Taxa)) +  labs(x = 'Taxa', y = 'pico_15N_enrichment', title = 'taxa vs pico_15N_enrichment') + theme(axis.text.x = element_text(angle = 90))
```

As well as boxplots for Taxa and Atom %
```{r}
#Pedino
ggplot(data = isotope_data) + 
  geom_boxplot(mapping = aes(x = Taxa, y = atom_13C_percent, color = Taxa)) +  
  labs(x = 'Taxa', y = 'atom 13C %', title = 'taxa vs pedino 13C %') + theme(axis.text.x = element_text(angle = 90))

#pico
ggplot(data = isotope_data) + 
  geom_boxplot(mapping = aes(x = Taxa, y = atom_15N_percent, color = Taxa)) +  
  labs(x = 'Taxa', y = "atom 15N %", title = 'taxa vs pico 15N %') + theme(axis.text.x = element_text(angle = 90))
 
```

basic taxa linear regression pedino
```{r}
pedino_taxa_lm = lm(isotope_data$pedino_13C_enrichment ~ -1 + isotope_data$Taxa)
summary(pedino_taxa_lm)
```

basic taxa linear regression pico
```{r}
pico_taxa_lm = lm(isotope_data$pico_15N_enrichment ~ -1 + isotope_data$Taxa)
summary(pico_taxa_lm)
```


Boxplots for enrichment by taxa mean- per panel

FC
```{r}
FC_isotope <- subset(isotope_data, isotope_data$Panel_Site == "FC")
ggplot(data = FC_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pedino_13C_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pedino_13C_enrichment', title = 'species vs pedino_13C_enrichment FC') + theme(axis.text.x = element_text(angle = 90))

ggplot(data = FC_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pico_15N_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pico_15N_enrichment', title = 'species vs pico_15N_enrichment FC') + theme(axis.text.x = element_text(angle = 90))

```

HI
```{r}
HI_isotope <- subset(isotope_data, isotope_data$Panel_Site == "HI")
ggplot(data = HI_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pedino_13C_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pedino_13C_enrichment', title = 'species vs pedino_13C_enrichment HI') + theme(axis.text.x = element_text(angle = 90))

ggplot(data = HI_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pico_15N_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pico_15N_enrichment', title = 'species vs pico_15N_enrichment HI') + theme(axis.text.x = element_text(angle = 90))

```

ID
```{r}
ID_isotope <- subset(isotope_data, isotope_data$Panel_Site == "ID")
ggplot(data = ID_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pedino_13C_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pedino_13C_enrichment', title = 'species vs pedino_13C_enrichment ID') + theme(axis.text.x = element_text(angle = 90))

ggplot(data = ID_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pico_15N_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pico_15N_enrichment', title = 'species vs pico_15N_enrichment ID') + theme(axis.text.x = element_text(angle = 90))

```

IRL_3
```{r}
IRL3_isotope <- subset(isotope_data, isotope_data$Panel_Site == "IRL3")
ggplot(data = IRL3_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pedino_13C_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pedino_13C_enrichment', title = 'species vs pedino_13C_enrichment IRL3') + theme(axis.text.x = element_text(angle = 90))

ggplot(data = IRL3_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pico_15N_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pico_15N_enrichment', title = 'species vs pico_15N_enrichment IRL3') + theme(axis.text.x = element_text(angle = 90))


```

MIM
```{r}
MIM_isotope <- subset(isotope_data, isotope_data$Panel_Site == "MIM")
ggplot(data = MIM_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pedino_13C_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pedino_13C_enrichment', title = 'species vs pedino_13C_enrichment MIM') + theme(axis.text.x = element_text(angle = 90))

ggplot(data = MIM_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pico_15N_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pico_15N_enrichment', title = 'species vs pico_15N_enrichment MIM') + theme(axis.text.x = element_text(angle = 90))

```

MO2
```{r}
MO2_isotope <- subset(isotope_data, isotope_data$Panel_Site == "MO2")
ggplot(data = MO2_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pedino_13C_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pedino_13C_enrichment', title = 'species vs pedino_13C_enrichment MO2') + theme(axis.text.x = element_text(angle = 90))

ggplot(data = MO2_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pico_15N_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pico_15N_enrichment', title = 'species vs pico_15N_enrichment MO2') + theme(axis.text.x = element_text(angle = 90))

```

SCD
```{r}
SCD_isotope <- subset(isotope_data, isotope_data$Panel_Site == "SCD")
ggplot(data = SCD_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pedino_13C_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pedino_13C_enrichment', title = 'species vs pedino_13C_enrichment SCD') + theme(axis.text.x = element_text(angle = 90))

ggplot(data = SCD_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pico_15N_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pico_15N_enrichment', title = 'species vs pico_15N_enrichment SCD') + theme(axis.text.x = element_text(angle = 90))


```

SMS
```{r}
SMS_isotope <- subset(isotope_data, isotope_data$Panel_Site == "SMS")
ggplot(data = SMS_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pedino_13C_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pedino_13C_enrichment', title = 'species vs pedino_13C_enrichment SMS') + theme(axis.text.x = element_text(angle = 90))

ggplot(data = SMS_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pico_15N_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pico_15N_enrichment', title = 'species vs pico_15N_enrichment SMS') + theme(axis.text.x = element_text(angle = 90))

```

WP
```{r}
WP_isotope <- subset(isotope_data, isotope_data$Panel_Site == "WP")
ggplot(data = WP_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pedino_13C_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pedino_13C_enrichment', title = 'species vs pedino_13C_enrichment WP') + theme(axis.text.x = element_text(angle = 90))

ggplot(data = WP_isotope) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pico_15N_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pico_15N_enrichment', title = 'species vs pico_15N_enrichment WP') + theme(axis.text.x = element_text(angle = 90))

```


Now we will create a dummy matrix (isotope_copy) in order to reorder the factor levels of Species ID by Taxa to graph a master plot of the Species and Enrichment values in an organized manner

```{r}
isotope_copy <- isotope_data
isotope_copy$Species_ID <- factor(isotope_copy$Species_ID)
isotope_copy$Species_ID <- fct_reorder(isotope_copy$Species_ID, isotope_copy$Taxa, .fun = max)
```

Species versus Pedino Enrichment
```{r}
ggplot(data = isotope_copy) + 
  geom_boxplot(mapping = aes(x = Species_ID, y = pedino_13C_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pedino_13C_enrichment', title = 'species vs pedino_13C_enrichment master') + theme(axis.text.x = element_text(angle = 90))
```

Species versus Pico enrichment
```{r}
ggplot(data = isotope_copy) +
  geom_boxplot(mapping = aes(x = Species_ID, y = pico_15N_enrichment, color=Taxa)) +  
  labs(x = 'species_id', y = 'pico_15N_enrichment', title = 'species vs pico_15N_enrichment master') + theme(axis.text.x = element_text(angle = 90))
```

subsetting the species of algae
```{r}
pedino_subset <- isotope_data[c('Site_and_Panel',"Species_ID","pedino_13C_enrichment","atom_13C_percent")]
pico_subset <- isotope_data[c('Site_and_Panel',"Species_ID","pico_15N_enrichment", "atom_15N_percent")]
```

creating community matrixes
```{r}
comm_pedino <- with(pedino_subset, tapply(pedino_13C_enrichment, list(Site_and_Panel, Species_ID), sum))
comm_pedino <- ifelse(is.na(comm_pedino), 0, comm_pedino)


comm_pico <- with(pico_subset, tapply(pico_15N_enrichment, list(Site_and_Panel, Species_ID), sum))
comm_pico <- ifelse(is.na(comm_pico), 0, comm_pico)
```

pico pca
```{r}
pico_pca = rda(comm_pico, scale = TRUE)
pico_pca
```

```{r}
# the eigenvalues sum up to equal the total interia (i.e., total variance in this case)
sum(pico_pca$CA$eig)
```

```{r}
# the ratio of the eigenvalue to the total variance is the amount of 
# variance explained by each PCA axis
round(pico_pca$CA$eig / pico_pca$tot.chi, 2)
#We can see from above that the PCA axis 1 captures approximately 17% of the total variance in the community matrix. Let's graph the data to better get a sense of the correlation structure.
```

```{r}
plot(pico_pca)
biplot(pico_pca)
```

```{r}
ordiplot(pico_pca, display = 'species')
orditorp(pico_pca, display = 'species')
```

pedino pca
```{r}
pedino_pca = rda(comm_pedino, scale = TRUE)
pedino_pca
```

```{r}
par(mfrow= c(1,1))
# the eigenvalues sum up to equal the total interia (i.e., total variance in this case)
sum(pedino_pca$CA$eig)
```

```{r}
# the ratio of the eigenvalue to the total variance is the amount of 
# variance explained by each PCA axis

round(pedino_pca$CA$eig / pedino_pca$tot.chi, 2)

#We can see from above that the PCA axis 1 captures approximately 16% of the total variance in the community matrix. Let's graph the data to better get a sense of the correlation structure.
```

```{r}
plot(pedino_pca)
biplot(pedino_pca)
```

```{r}
ordiplot(pedino_pca, display = 'species')
orditorp(pedino_pca, display = 'species')
```

I still want to do more work with these community matrixes, specifically relating to the species that are doing the most removal, and when.


